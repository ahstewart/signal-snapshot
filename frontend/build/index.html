<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Signal Analytics - Private, On-Device Insights</title><link rel="stylesheet" href="https://rsms.me/inter/inter.css"><script src="https://cdn.tailwindcss.com"></script><script src="https://unpkg.com/react@18/umd/react.development.js"></script><script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script><script src="https://unpkg.com/@babel/standalone/babel.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sql.js-sqlcipher@1.8.0/dist/sql-wasm.js"></script><script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react-chartjs-2@4.0.1/dist/index.min.js"></script><script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script><script src="https://cdn.jsdelivr.net/npm/chartjs-chart-wordcloud@3.1.0/dist/chartjs-chart-wordcloud.min.js"></script><script type="module">import{pipeline,env}from"https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1";window.pipeline=pipeline,window.env=env,window.env.allowLocalModels=!1</script><style>body{font-family:Inter,sans-serif;background-color:#f8fafc}.loader{border:4px solid #f3f3f3;border-top:4px solid #4f46e5;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.fade-in{animation:fadeIn 1s ease-in-out}.fade-out{animation:fadeOut .5s ease-in-out forwards}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes fadeOut{from{opacity:1}to{opacity:0;display:none}}.code-block{background-color:#eef2ff;color:#4338ca;padding:2px 6px;border-radius:4px;font-family:monospace;font-size:.9em}</style><script defer="defer" src="/signal-snapshot/static/js/main.eade38a1.js"></script><link href="/signal-snapshot/static/css/main.cd6ebc7f.css" rel="stylesheet"></head><body class="text-gray-800"><div id="landing-page" class="fade-in"><div class="container mx-auto px-6 py-12 md:py-20 max-w-4xl text-center"><h1 class="text-4xl md:text-6xl font-extrabold text-gray-900 leading-tight">Signal Analytics.</h1><p class="mt-4 text-lg md:text-xl text-gray-600">Visualize your conversations and understand personalities with 100% private, on-device AI. Your data never leaves your computer.</p><button id="launch-app-btn" class="mt-8 bg-indigo-600 text-white font-bold py-4 px-8 rounded-lg text-lg hover:bg-indigo-700 transition-transform transform hover:scale-105 shadow-lg">Launch App & Get Started</button></div><div class="container mx-auto px-6 py-12 max-w-4xl border-t border-gray-200"><h2 class="text-3xl font-bold text-center mb-6">How to Get Started (The Easy Way)</h2><div class="text-left max-w-2xl mx-auto space-y-4 text-gray-700"><p>This application can now read your encrypted Signal database directly in your browser. No third-party tools are needed.</p><p>Simply locate your Signal Desktop folder and you'll be ready to upload the two required files when you launch the app:</p><ol class="list-decimal list-inside space-y-3 pl-2"><li><span class="font-bold">The Database File:</span> <code class="code-block">db.sqlite</code></li><li><span class="font-bold">The Key File:</span> <code class="code-block">config.json</code></li></ol><p class="pt-2">Here’s where to find the folder on your computer:</p><ul class="list-disc list-inside space-y-2 pl-2"><li><strong>Windows:</strong> <code class="code-block">C:\Users\&lt;YourUsername&gt;\AppData\Roaming\Signal</code></li><li><strong>macOS:</strong> <code class="code-block">~/Library/Application Support/Signal/</code></li><li><strong>Linux:</strong> <code class="code-block">~/.config/Signal/</code></li></ul><p class="text-sm text-gray-500 pt-4"><strong>Important Note:</strong> Recent versions of Signal Desktop have started encrypting the key within `config.json`. This direct-upload method will only work if your key is stored in plaintext. If it doesn't work, you may need to use an external tool to first decrypt the key before using this app.</p></div></div><div class="bg-white py-12"></div><footer class="text-center py-8"><a href="https://www.buymeacoffee.com/YourAppName" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:text-indigo-800 font-semibold transition-colors">Enjoying the app? Consider supporting its development! ☕</a></footer></div><div id="app-container" class="hidden"></div><script type="text/babel">function initializeAndLaunchApp() {
            // --- Library loading logic ---
            const requiredLibs = ['React', 'ReactDOM', 'Babel', 'initSqlJs', 'Chart', 'ReactChartjs2', 'ChartJsChartWordcloud', 'pipeline'];
            const interval = setInterval(() => {
                const allLibsLoaded = requiredLibs.every(lib => window[lib]);
                if (allLibsLoaded) {
                    clearInterval(interval);
                    renderApp(); // This function contains the entire React App
                }
            }, 100);

            // --- App rendering logic ---
            function renderApp() {
                const { useState, useEffect, useMemo, useRef, useCallback } = React;
                const { pipeline } = window;
                const { WordCloudController, WordElement } = window.ChartJsChartWordcloud.controllers;
                Chart.register(WordCloudController, WordElement, Chart.LinearScale, Chart.PointElement, Chart.LineElement, Chart.BarElement, Chart.CategoryScale, Chart.DoughnutController, Chart.ArcElement, Chart.Tooltip, Chart.Legend, Chart.TimeScale);
                
                // --- Reusable Components ---
                const Card = ({ children, className }) => <div className={`bg-white rounded-xl shadow-md p-4 sm:p-6 ${className || ''}`}>{children}</div>;
                const Metric = ({ title, value }) => <Card className="text-center"><p className="text-lg text-gray-500">{title}</p><p className="text-4xl font-bold text-gray-800">{value}</p></Card>;
                const LoadingSpinner = ({ text }) => <div className="flex flex-col items-center justify-center p-4"><div className="loader"></div><p className="mt-2 text-sm text-gray-500">{text}</p></div>;
                
                // --- NEW File Upload Component ---
                const DirectDbUpload = ({ onDataParsed }) => {
                    const [dbFile, setDbFile] = useState(null);
                    const [configFile, setConfigFile] = useState(null);
                    const [isLoading, setIsLoading] = useState(false);
                    const [status, setStatus] = useState("Awaiting files...");
                    const sqlJs = useRef(null);

                    useEffect(() => {
                        if (dbFile && configFile && !isLoading) {
                            processFiles();
                        }
                    }, [dbFile, configFile]);

                    const processFiles = async () => {
                        setIsLoading(true);
                        setStatus("Initializing database engine...");
                        
                        try {
                            if (!sqlJs.current) {
                                sqlJs.current = await window.initSqlJs({
                                    locateFile: file => `https://cdn.jsdelivr.net/npm/sql.js-sqlcipher@1.8.0/dist/${file}`
                                });
                            }

                            setStatus("Reading files...");
                            const dbFileBuffer = await dbFile.arrayBuffer();
                            const configFileText = await configFile.text();

                            setStatus("Parsing key from config.json...");
                            const configJson = JSON.parse(configFileText);
                            const key = configJson.key;
                            if (!key || typeof key !== 'string') {
                                throw new Error("Could not find a valid 'key' in config.json.");
                            }

                            setStatus("Loading encrypted database...");
                            const db = new sqlJs.current.Database(new Uint8Array(dbFileBuffer));

                            setStatus("Decrypting database... (This may take a moment)");
                            db.exec(`PRAGMA key = "x'${key}'"`);
                            db.exec("SELECT count(*) FROM sqlite_master"); // Test decryption

                            setStatus("Querying messages...");
                            const res = db.exec("SELECT json, conversationId FROM messages");
                            db.close();
                            
                            if (res.length === 0 || res[0].values.length === 0) {
                                throw new Error("No messages found in the database.");
                            }
                            
                            setStatus("Processing data...");
                            const chatData = res[0].values.map(row => {
                                try {
                                    const message = JSON.parse(row[0]);
                                    // Construct a basic data structure similar to the old CSV format
                                    return {
                                        Date: new Date(message.timestamp).toISOString(),
                                        Author: message.sourceName || 'Unknown',
                                        Body: message.body || (message.attachments?.length > 0 ? '[Attachment]' : ''),
                                        Conversation: row[1]
                                    };
                                } catch {
                                    return null; // Ignore messages that can't be parsed
                                }
                            }).filter(Boolean); // Filter out any nulls

                            onDataParsed(chatData);

                        } catch (error) {
                            console.error("Database processing error:", error);
                            setStatus(`Error: ${error.message}. Check console for details. This may happen if the key in config.json is encrypted.`);
                            // Reset files on error
                            setDbFile(null);
                            setConfigFile(null);
                        } finally {
                            setIsLoading(false);
                        }
                    };

                    return (
                        <Card>
                            <div className="p-4">
                                <h3 className="text-xl font-semibold text-center mb-4">Upload Signal Data</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="flex flex-col items-center">
                                        <label htmlFor="db-file" className="cursor-pointer bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg w-full text-center">
                                            {dbFile ? `✔️ ${dbFile.name}` : "1. Upload db.sqlite"}
                                        </label>
                                        <input id="db-file" type="file" accept=".sqlite" className="hidden" onChange={e => setDbFile(e.target.files[0])} />
                                    </div>
                                    <div className="flex flex-col items-center">
                                         <label htmlFor="config-file" className="cursor-pointer bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg w-full text-center">
                                            {configFile ? `✔️ ${configFile.name}` : "2. Upload config.json"}
                                        </label>
                                        <input id="config-file" type="file" accept=".json" className="hidden" onChange={e => setConfigFile(e.target.files[0])} />
                                    </div>
                                </div>
                                {isLoading && <LoadingSpinner text={status} />}
                                {!isLoading && dbFile && configFile && <p className="text-center mt-4 text-green-600">Files ready. Processing...</p>}
                            </div>
                        </Card>
                    );
                };

                // --- Other Components (Dashboard, OnDeviceAI, etc.) ---
                // These components remain largely the same, as they consume the `chatData` object
                const OnDeviceAI = ({ data, users }) => { /* ... unchanged ... */ };
                const WordCloudChart = ({ data, options }) => { /* ... unchanged ... */ };
                const Dashboard = ({ data, Line, Doughnut }) => { /* ... unchanged ... */ };
                const App = () => {
                    const [chatData, setChatData] = useState(null);
                    return (
                        <div className="fade-in min-h-screen bg-gray-100 p-4 sm:p-6 lg:p-8">
                            <div className="max-w-7xl mx-auto">
                                <header className="mb-8"><h1 className="text-4xl font-bold text-gray-800 text-center tracking-tight">Signal Analytics</h1></header>
                                <main>
                                    <div className="mb-6">
                                      {/* Use the new upload component */}
                                      <DirectDbUpload onDataParsed={setChatData} />
                                    </div>
                                    {chatData ? <Dashboard data={chatData} Line={window.ReactChartjs2.Line} Doughnut={window.ReactChartjs2.Doughnut} /> : <Card><p className="text-center text-gray-500 py-8">Your dashboard will appear here once you upload your files.</p></Card>}
                                </main>
                            </div>
                        </div>
                    );
                };
                
                const container = document.getElementById('app-container');
                const root = ReactDOM.createRoot(container);
                root.render(<App />);
            }

            // --- Event listener to launch the app ---
            document.getElementById('launch-app-btn').addEventListener('click', () => {
                document.getElementById('landing-page').classList.add('fade-out');
                const appContainer = document.getElementById('app-container');
                appContainer.classList.remove('hidden');
                
                // Start the app initialization process
                initializeAndLaunchApp();
            });
        }
        
        // Run the setup function after the initial DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeAndLaunchApp);</script></body></html>