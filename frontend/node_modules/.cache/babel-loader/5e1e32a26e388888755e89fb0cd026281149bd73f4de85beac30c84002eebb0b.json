{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Alert,Box,Button,CircularProgress,FormControl,Grid,InputLabel,MenuItem,Paper,Select,Typography}from'@mui/material';import{loadUsers,loadIndividualStats}from'../utils/database';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const IndividualStats=()=>{const[file,setFile]=useState(null);const[dbBuffer,setDbBuffer]=useState(null);const[dbKey,setDbKey]=useState(undefined);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[users,setUsers]=useState([]);const[selectedUser,setSelectedUser]=useState('');const[statsData,setStatsData]=useState(null);useEffect(()=>{if(selectedUser&&dbBuffer){fetchIndividualStats(selectedUser);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[selectedUser]);const handleFileChange=e=>{var _e$target$files$,_e$target$files;const selectedFile=(_e$target$files$=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0])!==null&&_e$target$files$!==void 0?_e$target$files$:null;setFile(selectedFile);setUsers([]);setSelectedUser('');setStatsData(null);setError(null);setDbBuffer(null);setDbKey(undefined);if(selectedFile){selectedFile.arrayBuffer().then(buffer=>{setDbBuffer(buffer);});}};const handleUploadAndAnalyse=async()=>{if(!dbBuffer)return;setLoading(true);setError(null);setUsers([]);try{const userList=await loadUsers(dbBuffer,undefined);setUsers(userList);setDbKey(undefined);}catch(err){if(err instanceof Error&&err.message.includes('Please provide a key')){const key=window.prompt('This database appears to be encrypted. Please provide your key:');if(key){setDbKey(key);try{const userList=await loadUsers(dbBuffer,key);setUsers(userList);}catch(secondErr){const msg=secondErr instanceof Error?secondErr.message:'An unknown error occurred during decryption.';setError(msg);}}else{setError('An encryption key is required to process this file.');}}else{const msg=err instanceof Error?err.message:'An unknown error occurred.';setError(msg);}}finally{setLoading(false);}};const fetchIndividualStats=async userId=>{if(!dbBuffer)return;setLoading(true);setError(null);try{const stats=await loadIndividualStats(dbBuffer,dbKey,userId);setStatsData(stats);}catch(err){const msg=err instanceof Error?err.message:'An unknown error occurred.';setError(msg);}finally{setLoading(false);}};const handleUserChange=event=>{setSelectedUser(event.target.value);};const renderKpiCard=(title,value)=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:4,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2,textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"div\",children:value}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",children:title})]})});return/*#__PURE__*/_jsxs(Box,{sx:{p:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"Individual Stats\"}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:2,alignItems:'center',mb:4},children:[/*#__PURE__*/_jsxs(Button,{variant:\"contained\",component:\"label\",disabled:loading,children:[\"Select Database\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".db,.sqlite\",hidden:true,onChange:handleFileChange})]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",onClick:handleUploadAndAnalyse,disabled:loading||!file,children:loading&&!statsData?'Loading Users…':'Load Users'}),loading&&/*#__PURE__*/_jsx(CircularProgress,{size:24})]}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:2},children:error}),users.length>0&&/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,sx:{mb:4},children:[/*#__PURE__*/_jsx(InputLabel,{id:\"user-select-label\",children:\"Select User\"}),/*#__PURE__*/_jsx(Select,{labelId:\"user-select-label\",value:selectedUser,label:\"Select User\",onChange:handleUserChange,children:users.map(user=>/*#__PURE__*/_jsx(MenuItem,{value:user.id,children:user.name},user.id))})]}),statsData&&/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[renderKpiCard('Total Messages Sent',statsData.totalMessagesSent),renderKpiCard('Most Popular Day',statsData.mostPopularDay),renderKpiCard('Total Reactions Sent',statsData.totalReactionsSent)]})]});};export default IndividualStats;","map":{"version":3,"names":["React","useState","useEffect","Alert","Box","Button","CircularProgress","FormControl","Grid","InputLabel","MenuItem","Paper","Select","Typography","loadUsers","loadIndividualStats","jsx","_jsx","jsxs","_jsxs","IndividualStats","file","setFile","dbBuffer","setDbBuffer","dbKey","setDbKey","undefined","loading","setLoading","error","setError","users","setUsers","selectedUser","setSelectedUser","statsData","setStatsData","fetchIndividualStats","handleFileChange","e","_e$target$files$","_e$target$files","selectedFile","target","files","arrayBuffer","then","buffer","handleUploadAndAnalyse","userList","err","Error","message","includes","key","window","prompt","secondErr","msg","userId","stats","handleUserChange","event","value","renderKpiCard","title","item","xs","sm","children","sx","p","textAlign","variant","component","color","gutterBottom","display","gap","alignItems","mb","disabled","type","accept","hidden","onChange","onClick","size","severity","length","fullWidth","id","labelId","label","map","user","name","container","spacing","totalMessagesSent","mostPopularDay","totalReactionsSent"],"sources":["E:/ahste/Projects/signal-analytics/frontend/src/components/IndividualStats.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport {\n  Alert,\n  Box,\n  Button,\n  CircularProgress,\n  FormControl,\n  Grid,\n  InputLabel,\n  MenuItem,\n  Paper,\n  Select,\n  SelectChangeEvent,\n  Typography,\n} from '@mui/material';\nimport { User, IndividualStatsData, loadUsers, loadIndividualStats } from '../utils/database';\n\nconst IndividualStats: React.FC = () => {\n  const [file, setFile] = useState<File | null>(null);\n  const [dbBuffer, setDbBuffer] = useState<ArrayBuffer | null>(null);\n  const [dbKey, setDbKey] = useState<string | undefined>(undefined);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [users, setUsers] = useState<User[]>([]);\n  const [selectedUser, setSelectedUser] = useState<string>('');\n  const [statsData, setStatsData] = useState<IndividualStatsData | null>(null);\n\n  useEffect(() => {\n    if (selectedUser && dbBuffer) {\n      fetchIndividualStats(selectedUser);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedUser]);\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\n    const selectedFile = e.target.files?.[0] ?? null;\n    setFile(selectedFile);\n    setUsers([]);\n    setSelectedUser('');\n    setStatsData(null);\n    setError(null);\n    setDbBuffer(null);\n    setDbKey(undefined);\n    if (selectedFile) {\n      selectedFile.arrayBuffer().then(buffer => {\n        setDbBuffer(buffer);\n      });\n    }\n  };\n\n  const handleUploadAndAnalyse = async (): Promise<void> => {\n    if (!dbBuffer) return;\n\n    setLoading(true);\n    setError(null);\n    setUsers([]);\n\n    try {\n      const userList = await loadUsers(dbBuffer, undefined);\n      setUsers(userList);\n      setDbKey(undefined);\n    } catch (err) {\n      if (err instanceof Error && err.message.includes('Please provide a key')) {\n        const key = window.prompt('This database appears to be encrypted. Please provide your key:');\n        if (key) {\n          setDbKey(key);\n          try {\n            const userList = await loadUsers(dbBuffer, key);\n            setUsers(userList);\n          } catch (secondErr) {\n            const msg = secondErr instanceof Error ? secondErr.message : 'An unknown error occurred during decryption.';\n            setError(msg);\n          }\n        } else {\n          setError('An encryption key is required to process this file.');\n        }\n      } else {\n        const msg = err instanceof Error ? err.message : 'An unknown error occurred.';\n        setError(msg);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchIndividualStats = async (userId: string) => {\n    if (!dbBuffer) return;\n\n    setLoading(true);\n    setError(null);\n    try {\n      const stats = await loadIndividualStats(dbBuffer, dbKey, userId);\n      setStatsData(stats);\n    } catch (err) {\n      const msg = err instanceof Error ? err.message : 'An unknown error occurred.';\n      setError(msg);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleUserChange = (event: SelectChangeEvent<string>) => {\n    setSelectedUser(event.target.value);\n  };\n\n  const renderKpiCard = (title: string, value: string | number) => (\n    <Grid item xs={12} sm={4}>\n      <Paper sx={{ p: 2, textAlign: 'center' }}>\n        <Typography variant=\"h4\" component=\"div\">{value}</Typography>\n        <Typography variant=\"body1\" color=\"text.secondary\">{title}</Typography>\n      </Paper>\n    </Grid>\n  );\n\n  return (\n    <Box sx={{ p: 4 }}>\n      <Typography variant=\"h4\" gutterBottom>\n        Individual Stats\n      </Typography>\n\n      <Box sx={{ display: 'flex', gap: 2, alignItems: 'center', mb: 4 }}>\n        <Button variant=\"contained\" component=\"label\" disabled={loading}>\n          Select Database\n          <input type=\"file\" accept=\".db,.sqlite\" hidden onChange={handleFileChange} />\n        </Button>\n        <Button variant=\"contained\" color=\"secondary\" onClick={handleUploadAndAnalyse} disabled={loading || !file}>\n          {loading && !statsData ? 'Loading Users…' : 'Load Users'}\n        </Button>\n        {loading && <CircularProgress size={24} />}\n      </Box>\n\n      {error && <Alert severity=\"error\" sx={{ mb: 2 }}>{error}</Alert>}\n\n      {users.length > 0 && (\n        <FormControl fullWidth sx={{ mb: 4 }}>\n          <InputLabel id=\"user-select-label\">Select User</InputLabel>\n          <Select\n            labelId=\"user-select-label\"\n            value={selectedUser}\n            label=\"Select User\"\n            onChange={handleUserChange}\n          >\n            {users.map(user => (\n              <MenuItem key={user.id} value={user.id}>\n                {user.name}\n              </MenuItem>\n            ))}\n          </Select>\n        </FormControl>\n      )}\n\n      {statsData && (\n        <Grid container spacing={3}>\n          {renderKpiCard('Total Messages Sent', statsData.totalMessagesSent)}\n          {renderKpiCard('Most Popular Day', statsData.mostPopularDay)}\n          {renderKpiCard('Total Reactions Sent', statsData.totalReactionsSent)}\n        </Grid>\n      )}\n    </Box>\n  );\n};\n\nexport default IndividualStats;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}